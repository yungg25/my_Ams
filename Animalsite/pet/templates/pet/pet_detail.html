{% extends "pet/pet_base.html" %}

{% block title %}{{ animal.name }} ìƒì„¸ í˜ì´ì§€{% endblock %}

{% block content %}
<div style="max-width: 700px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); text-align: center;">
  <h2 style="margin-bottom: 10px;">
    {{ animal.name }} ğŸ¾

    {% if user.is_authenticated %}
      <form method="post" action="{% url 'pet:animal_like' animal.id %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" style="background: none; border: none; font-size: 20px; cursor: pointer; vertical-align: middle;">
          {% if user in animal.likes.all %}
            â¤ï¸
          {% else %}
            ğŸ¤
          {% endif %}
        </button>
      </form>
      <span style="font-size: 14px; color: #777;">ì¢‹ì•„ìš” {{ animal.likes.count }}ê°œ</span>
    {% endif %}
  </h2>

  {% if animal.image %}
    <div style="width: 100%; aspect-ratio: 4 / 3; background-color: #f8f8f8; border-radius: 12px; margin-bottom: 20px;">
      <img src="{{ animal.image.url }}" alt="{{ animal.name }}"
           style="width: 100%; height: 100%; object-fit: contain; padding: 10px;">
    </div>
  {% endif %}

  <ul style="text-align: left; line-height: 1.8; margin: 20px auto; max-width: 500px;">
    <li><strong>ì¢…:</strong> {{ animal.species }}</li>
    <li><strong>ê²¬ì¢…:</strong> {{ animal.breed|default:"-" }}</li>
    <li><strong>ë‚˜ì´:</strong> {{ animal.age }}ì‚´</li>
    <li><strong>ì„±ë³„:</strong> {{ animal.gender }}</li>
    <li><strong>ì¤‘ì„±í™” ìœ ë¬´:</strong> {{ animal.neutered|yesno:"âœ… ì˜ˆ,âŒ ì•„ë‹ˆì˜¤" }}</li>
    <li><strong>ì˜ˆë°©ì ‘ì¢…:</strong> {{ animal.vaccinated|yesno:"âœ… ì™„ë£Œ,âŒ ë¯¸ì™„ë£Œ" }}</li>
    <li><strong>ë“±ë¡ì¼:</strong> {{ animal.created_at|date:"Yë…„ mì›” dì¼ H:i" }}</li>
  </ul>

  {% if animal.personality %}
    <p><strong>ì„±ê²©:</strong><br>{{ animal.personality|linebreaks }}</p>
  {% endif %}

  {% if animal.description %}
    <p style="margin-top: 20px;"><strong>ì†Œê°œ:</strong><br>{{ animal.description|linebreaks }}</p>
  {% endif %}

  <!-- ì´ì „/ë‹¤ìŒ ë²„íŠ¼ -->
  <div style="margin: 30px 0; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
    {% if prev_animal %}
      <a href="{% url 'pet:animal_detail' prev_animal.id %}">
        <button style="padding: 8px 16px; border: none; border-radius: 6px; background-color: #adb5bd; color: white; cursor: pointer;">
          â† ì´ì „: {{ prev_animal.name }}
        </button>
      </a>
    {% else %}
      <div></div>
    {% endif %}

    {% if next_animal %}
      <a href="{% url 'pet:animal_detail' next_animal.id %}">
        <button style="padding: 8px 16px; border: none; border-radius: 6px; background-color: #6c757d; color: white; cursor: pointer;">
          ë‹¤ìŒ: {{ next_animal.name }} â†’
        </button>
      </a>
    {% endif %}
  </div>

  <!-- ëŒ“ê¸€ -->
  <div style="margin-top: 40px; text-align: left;">
    <h3>ğŸ’¬ ëŒ“ê¸€</h3>
    {% if comments %}
      <ul>
        {% for comment in comments %}
          <li style="margin-bottom: 10px; background: #f1f1f1; padding: 10px; border-radius: 6px;">
            <strong>{{ comment.user.username }}</strong>
            <small>{{ comment.created_at|date:"Y.m.d H:i" }}</small><br>
            {{ comment.content|linebreaksbr }}
            {% if request.user == comment.user or request.user.is_superuser %}
              <form method="post" action="{% url 'pet:delete_animal_comment' animal.id comment.id %}" style="display:inline; float:right;">
                {% csrf_token %}
                <button type="submit" style="background: none; border: none; color: red;">ğŸ—‘</button>
              </form>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p style="color: #888;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}

    {% if user.is_authenticated %}
      <form method="post" action="{% url 'pet:animal_comment' animal.id %}" style="margin-top: 20px;">
        {% csrf_token %}
        {{ comment_form.content }}
        <br>
        <button type="submit" style="margin-top: 10px; padding: 6px 12px; background: #4e89ae; color: white; border: none; border-radius: 4px;">
          ëŒ“ê¸€ ì‘ì„±
        </button>
      </form>
    {% endif %}
  </div>

  <!-- í•˜ë‹¨ ì œì–´ ë²„íŠ¼ -->
  <div style="margin-top: 30px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
    <a href="{% url 'pet:animal_list' %}">
      <button style="padding: 8px 16px; border: none; border-radius: 6px; background-color: #ccc; color: #333; cursor: pointer;">
        â† ë’¤ë¡œê°€ê¸°
      </button>
    </a>

    {% if request.user.is_authenticated %}
      <a href="{% url 'pet:animal_update' animal.id %}"><button style="padding: 8px 16px; border: none; border-radius: 6px; background-color: #4e89ae; color: white; cursor: pointer;">
        âœï¸ ìˆ˜ì •
      </button></a>

      <form action="{% url 'pet:animal_delete' animal.id %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit"
                onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')"
                style="padding: 8px 16px; border: none; border-radius: 6px; background-color: #e63946; color: white; cursor: pointer;">
          ğŸ”š ì‚­ì œ
        </button>
      </form>
    {% endif %}
  </div>
</div>
{% endblock %}
